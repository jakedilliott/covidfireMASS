---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# covidfireMASS
<!-- badges: start -->
[![Project Status: WIP â€“ Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](https://www.repostatus.org/badges/latest/wip.svg)](https://www.repostatus.org/#wip)
[![license](https://img.shields.io/badge/license-MIT + file LICENSE-lightgrey.svg)](https://choosealicense.com/)
[![minimal R version](https://img.shields.io/badge/R%3E%3D-`2.10`-6666ff.svg)](https://cran.r-project.org/)
<!-- badges: end -->

## Covid Fire Multi Agent Seasona Simulation

An Agent-Based Model that simulates COVID dynamics within wildfire firefighter camps. This model assumes a hub-and-spoke camp model, which implements module based infection dynamics and quarantine protocols. This work is an extension of the Susceptible Infected Recovered(SIR) model, adding Exposed, Asymptomatic, and Quarantined agent health states. Hence the SEIRAQ model.

## Installation

You can install the development version of covidfireMASS from [GitHub](https//:github.com) with:

``` r
devtools::install_github("jakedilliott/covidfireMASS")
```

## Necessary Data

### Incident Assignments

- Each row is a unique fire fighter/resource
- res_id: numeric, resource ID number
- res_gacc: character, resource home GACC (Geographic Area Coordination Center)
- Each column to the right of the second column is labeled with a date and each cell contains an incident that shows which fire each resource was assigned to on that day. 

Example: Resource 001 was on fire 1046 from 01/01/2020 - 01/01/2020

```{r echo=FALSE, results='asis'}
library(knitr)
df = data.frame(
  'res_id' = c(1001, 1002, 1003),
  'res_gacc' = c('NM-SWC', 'OR-NWC', 'OR-NWC'),
  '2020-01-01' = c(1046, 1055, 0),
  '2020-01-02' = c(1046, 1055, 0),
  '2020-01-03' = c(1046, 0, 1055),
  '...' = c('...', '...', '...')
)
kable(df, caption = "Incident Assignments Table")
```

   
### Module Assignments

- res_id and res_gacc columns here are the same as the module assignments data
- Each column to the right of the second column is labeled with a date and each cell contains a module ID that describes which module (team or crew) each resource was assigned to each day. These module ID's are only unique when paired with the incident of each agent on that day, there are modules with the same ID across multiple fires. 

```{r echo=FALSE, results='asis'}
df = data.frame(
  'res_id' = c(1001, 1002, 1003),
  'res_gacc' = c('NM-SWC', 'OR-NWC', 'OR-NWC'),
  '2020-01-01' = c('E-1', 'O-12', '0'),
  '2020-01-02' = c('E-1', 'O-12', '0'),
  '2020-01-03' = c('E-1', '0', 'C-8'),
  '...' = c('...', '...', '...')
)
kable(df, caption = "Module Assignments Table")
```
   
### Incident Information

| inc_id | inc_number | inc_name | inc_gacc | inc_lat | inc_lon | max_team_type | first_day | last_day |
   
## Minimal Example

``` r
library(covidfireMASS)
library(readr)
library(dplyr)
library(ggplot2)

# Load necessary data
inc_assignments <- read_csv("path/to/inc_assignments.csv")
mod_assignments <- read_csv("path/to/mod_assignments.csv")
inc_info <- read.csv("path/to/inc_info.csv")

# Default simulation run, see ?seasonal_sim for default inputs
sim1 <- seasonal_sim(inc_assignments, mod_assignments, inc_info)

# Reducing vaccination rate for the Southwest GACC and specifying an initial vaccinated population.
sim2 <- seasonal_sim(inc_assignments, mod_assignments, inc_info,
                     varying_vax = list(gacc = "NM-SWC", rate = 0.005),
                     R_init = 5000)
                     
sapply(sim2, class)
# res_id    res_gacc      inc_id      mod_id      leader       state  quarantine      q_days  vaccinated 
#   "numeric" "character"   "numeric" "character"   "logical" "character"   "logical"   "numeric"   "logical" 
#   vax_rate        time 
#  "numeric"   "numeric"

# Graphing quarantined work force

to_plot <- sim2 %>%
  filter(inc_id > 0, quarantined) %>%
  count(time, res_gacc)
  
p <- ggplot(to_plot, aes(time, n, color = res_gacc)) +
  geom_col(position = "stack")
```
